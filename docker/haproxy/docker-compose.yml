version: '3.7'
services:
  mysql-master1:
    image: uoles/mysql
    container_name: mysql-1
    command: --default-authentication-plugin=mysql_native_password
    env_file: .env
    ports:
      - "6611:3306"
    cap_add:
      - all
    volumes:
      - /home/uoles/project/mysql_db_haproxy_1:/var/lib/mysql
      - /home/uoles/project/mysql_db_haproxy_1_conf:/etc/mysql
    environment:
      - MYSQL_ROOT_PASSWORD:${MYSQL_ROOT_PASSWORD}
    networks:
      default:
        aliases:
          - mysql

  mysql-master2:
    image: uoles/mysql
    container_name: mysql-2
    command: --default-authentication-plugin=mysql_native_password
    env_file: .env
    ports:
      - "6612:3306"
    cap_add: 
      - all
    volumes:
      - /home/uoles/project/mysql_db_haproxy_2:/var/lib/mysql
      - /home/uoles/project/mysql_db_haproxy_2_conf:/etc/mysql
    environment:
      - MYSQL_ROOT_PASSWORD:${MYSQL_ROOT_PASSWORD}
    networks:
      default:
        aliases:
          - mysql

  haproxy:
    image: haproxytech/haproxy-ubuntu:latest
    container_name: haproxy
    ports:
      - "2999:2999"
      - "3306:3306"
    cap_add:
      - all
    volumes:
      - ./haproxy.cfg:/usr/local/etc/haproxy/haproxy.cfg
    networks:
      default:
        aliases:
          - mysql
